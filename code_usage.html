<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Construct your Airtrack setup !</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./static/Logo/favicon.ico" />
<link rel="icon" type="image/png" href="./static/Logo/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="./static/Logo/favicon-16x16.png" sizes="16x16" />

    <link href="./static/style.css" rel="stylesheet">
                  <style>
    .nav-list a.navhome, .sub-nav-list a.navhome{
      background-color: #f1502f !important;
    }
    .gallery-thumb img:hover {
      border: 4px solid #f1502f;
    }
  </style>
<style>
  .nav-list a.active, .sub-nav-list a.active {
    background-color: #cccccc !important;
  }
</style>
<style>
  .nav-list a:hover:not(.active), .sub-nav-list a:hover:not(.active) {
    background-color: #555555 !important;
  }
</style>
<style>
.gallery-show img {
  border: none;
}
</style>
<style>
.gallery-show img {
  background: none;
}
</style>
    
</head>
<body>
<header class="site-header">
    <div class="wrapper header-wrapper" >
        <div class=header-text>
   
    <h1 class="site-title">Construct your Airtrack setup !</h1>
</div>
            </div>
</header>
<div class="page-content">
            <div>
            <nav class="sidebar">
                <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
                </a>
                <ul class="nav-list">
                <li>
    <a class="navhome" href="./">
        Construct your Airtrack setup !
    </a>
</li>
<li class="not-active">
    <a class="not-active" href="./airtable.html">
        Construction of the air table
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./precut.html">
        Airtable part 1: Precut of the aluminium profile strut
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./predrill.html">
        Airtable part 2: Predrill
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./glue.html">
        Airtable part 3: Glueing and screwing
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./basicframework.html">
        Airtable part 4: Construction of the framework
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./ballvalve.html">
        Airtable part 5: Insertion of ball valves
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./air_flow.html">
        Airtable part 6: Incoming air and pressure control
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./peripherals.html">
        Construction of the peripherals
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./headandcamera.html">
        Peripherals part 1: Attaching the camera
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./actuator_head.html">
        Peripherals part 2: Construction of the linear actuator front
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./rewardsystem.html">
        Peripherals part 3: Construction of the rewarding system
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./headfixation.html">
        Peripherals part 4: Construction of the head fixation 
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./3Dprinting.html">
        Peripherals part 5: Floating platform
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./setup_electronic.html">
        Set up of the electronics
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./electronic.html">
        Electronics part 1: Set up of the wiring
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./script_setup.html">
        Electronics part 2: Uploading of scripts to the Arduino Uno
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./PixyCamConfig.html">
        Electronics part 3: Configuration of the PixyCam 2
    </a>
    </li>
<li class="active">
    <a class="active" href="./code_usage.html">
        Electronics part 4: Arduino code guide
    </a>
    </li>

                </ul>
            </nav>
        </div>
        <div class="wrapper">
    <h1 id="electronics-part-4-arduino-code-guide">Electronics part 4: Arduino code guide</h1>
<p>The provided code handles a complex workflow. It tracks the position of the mouse and provides positional feedback and rewards. This process requires several external components which are set up at the start of the script. If errors arise, it's most likely within this section. </p>
<p>For debugging you need to implement several print messages and check which get outputted and which not.</p>
<ul>
<li>
<p>There are currently the main important prints to check the functionality implemented. You can enable them by setting the variable test_run to "true". This variable is located at the top of the ".ino" file. </p>
<ul>
<li>If all messages get printed, the set up should work as intended. </li>
<li>Additionally, you can test it by moving the platform until the prints state to be in the reward lane. These prints are always enabled. </li>
</ul>
</li>
<li>
<p>You might need some extra debugging if unexpected errors occur.</p>
<ul>
<li>Code example for additional printing: Serial.print("Start sensor setup  ");</li>
</ul>
</li>
</ul>
<h3 id="test-run" pagestep="pagestep">Test run</h3>
<p>You can test the functionality by moving the platform until the prints state to be in the reward lane. These prints are always enabled. </p>
<ul>
<li>
<p>Imagine to be a head fixed mouse while moving the platform. </p>
</li>
<li>
<p>Depending on the choice of the lick spot a reward should be provided or not. </p>
</li>
<li>
<p>Below you can view the hole workflow as displayed in the paper   <a href="https://doi.org/10.1152/jn.00088.2016" target="_blank" title="">Air-Track: a real-world floating environment for active sensing in head-fixed mice</a> in figure 3.</p>
</li>
</ul>
<p><img alt="" src="images/flowchart.png" title="" /></p>
<h3 id="capacitive-sensor-mpr121" pagestep="pagestep">Capacitive sensor MPR121</h3>
<ul>
<li>
<p>To test the functionality of the MPR121 use the test.ino provided in the Github repository </p>
</li>
<li>
<p>https://github.com/adafruit/Adafruit_MPR121/blob/master/examples/MPR121test/MPR121test.ino</p>
</li>
<li>
<p>To change the threshold for touch and release you need to adjust these both values in the sensor.h:</p>
<ul>
<li>define NEW_TOU_THRESH 0x02</li>
<li>define NEW_REL_THRESH 0x35</li>
</ul>
</li>
<li>
<p>Depending on your wiring the MPR121 will register more or less contacts. You might need to change the thresholds.</p>
<ul>
<li>These values can be found in the definitions.h file starting with "static const long int SAME_SENSOR_MAX_THRESHOLD = 500;"</li>
</ul>
</li>
</ul>
<h3 id="test-pixycam2" pagestep="pagestep">Test Pixycam2</h3>
<ul>
<li>
<p>To test the Pixycam2 select within the Arduino IDE file -&gt; examples -&gt; Pixy2 -&gt; ccc_hello_world</p>
</li>
<li>
<p>The program permanently prints if it detects a specified object and includes the parameters</p>
</li>
</ul>
<h3 id="adjust-pixel-values-in-code" pagestep="pagestep">Adjust pixel values in code</h3>
<p>Depending on the position of your camera you need to adjust the pixel values for the tracked platform in the code.</p>
<ul>
<li>
<p>The minimal and maximal x and y values specify the pixels in the camera view where the center of the platform is if the mouse is in a lane.</p>
<ul>
<li>These values can be found in the definitions.h file starting with "DistancesStruct ()"</li>
</ul>
</li>
<li>
<p>Use the "ccc_hello_world" to determine pixel values of the area </p>
</li>
</ul>
<h3 id="linear-actuator" pagestep="pagestep">Linear actuator</h3>
<ul>
<li>
<p>The airtrack code Github repository contains a linear actuator moving file which also can be used to test it</p>
</li>
<li>
<p>The default mode of the code is to pull</p>
</li>
</ul>
<hr />
<p><a href="PixyCamConfig.html">Previous page</a></p>
    </div>
</div>
<footer class="site-footer">
    <div class="wrapper">
        <a target="_blank" rel="noopener noreferrer" href="https://gitbuilding.io">
    <img class="icon" src="./static/Logo/GitBuilding500x.png" alt="GitBuilding logo">
    <span class="info">Documentation powered by GitBuilding</span>
</a>

    </div>
</footer></body>
</html>